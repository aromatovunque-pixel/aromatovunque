<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Aromat Game</title>

<style>
body{
  margin:0;
  background:#070b18;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family: monospace;
  color:#c7d2fe;
  touch-action:none;
}
.wrap{
  background:#0f1629;
  border:3px solid #2a3350;
  padding:12px;
  box-shadow:0 0 0 4px #050712;
  position:relative;
}
canvas{
  width:min(96vw,420px);
  image-rendering:pixelated;
  border:2px solid #2a3350;
  background:#050712;
  touch-action:none;
}
.hud{
  display:flex;
  justify-content:space-between;
  margin-bottom:4px;
  font-size:14px;
}
.hud b{color:#facc15}

.title{
  text-align:center;
  margin-bottom:6px;
  color:#facc15;
  text-shadow:
    0 0 6px #facc15,
    0 0 12px #facc15;
}
.subtitle{
  font-size:12px;
  color:#c7d2fe;
}

.start{
  margin-top:6px;
  width:100%;
  padding:14px;
  font-size:22px;
  font-weight:bold;
  background:#111a33;
  color:#facc15;
  border:3px solid #facc15;
}
.start.blink{
  animation: blink 1s infinite;
}
@keyframes blink{
  0%,50%{opacity:1}
  51%,100%{opacity:0.3}
}

.controls{
  margin-top:6px;
  display:flex;
  gap:6px;
}
.controls button{
  flex:1;
  padding:10px;
  font-size:16px;
  background:#111a33;
  border:2px solid #2a3350;
  color:#fff;
}

/* BANNER FINALE */
.banner{
  position:absolute;
  inset:0;
  background:rgba(5,7,18,0.92);
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
}
.banner.show{display:flex}
.banner .box{
  border:3px solid #facc15;
  padding:16px;
  background:#0f1629;
  box-shadow:0 0 0 4px #050712;
}
.banner h1{
  margin:0;
  color:#facc15;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="title">
    <div>AROMAT GAME!</div>
    <div class="subtitle">Spara l’aromat sulla pizza</div>
  </div>

  <div class="hud">
    <div>Score <b id="score">0</b></div>
    <div>Tempo <b id="time">15</b>s</div>
  </div>

  <canvas id="game" width="320" height="180"></canvas>

  <button id="start" class="start blink">START</button>

  <div class="controls">
    <button id="left">◀</button>
    <button id="fire">SPARA</button>
    <button id="right">▶</button>
  </div>

  <div id="banner" class="banner">
    <div class="box">
      <h1>COMPLIMENTI!</h1>
      <div>Hai vinto l'opportunità di pagarmi da bere!!</div>
    </div>
  </div>
</div>

<script>
const c=document.getElementById("game");
const ctx=c.getContext("2d");
const W=c.width,H=c.height;

let running=false, score=0, timeLeft=30, timerId=null;

const scoreEl=document.getElementById("score");
const timeEl=document.getElementById("time");
const startBtn=document.getElementById("start");
const banner=document.getElementById("banner");

const player={x:160,y:150,w:26,h:36,cooldown:0};
const bullets=[];
const pizza={x:160,y:60,r:20,vx:1.5};
const grains=[];

// ===== PIXEL TEXT =====
function pixelText(txt,x,y,color){
  const map={
    A:["0110","1001","1111","1001","1001"],
    R:["1110","1001","1110","1010","1001"],
    O:["0110","1001","1001","1001","0110"],
    M:["1001","1111","1111","1001","1001"],
    T:["1111","0010","0010","0010","0010"],
    G:["0111","1000","1011","1001","0111"],
    E:["1111","1000","1110","1000","1111"],
    I:["111","010","010","010","111"],
    L:["1000","1000","1000","1000","1111"]
  };
  ctx.fillStyle=color;
  let cx=x;
  for(const ch of txt){
    const g=map[ch];
    if(!g){cx+=6;continue}
    for(let r=0;r<g.length;r++)
      for(let col=0;col<g[r].length;col++)
        if(g[r][col]==="1")
          ctx.fillRect(cx+col,y+r,1,1);
    cx+=6;
  }
}

// ===== DRAW =====
function drawAromat(){
  const l=player.x-player.w/2,t=player.y-player.h/2;
  ctx.fillStyle="#f6d32d";
  ctx.fillRect(l,t+6,player.w,player.h-6);
  ctx.fillStyle="#d3181c";
  ctx.fillRect(l+2,t,player.w-4,7);
  ctx.fillStyle="#12a14a";
  ctx.fillRect(l+1,t+18,player.w-2,14);
  pixelText("AROMAT",l+4,t+22,"#fff");
}

function drawPizza(){
  ctx.fillStyle="#d97706";
  ctx.beginPath();ctx.arc(pizza.x,pizza.y,pizza.r+4,0,7);ctx.fill();
  ctx.fillStyle="#fef3c7";
  ctx.beginPath();ctx.arc(pizza.x,pizza.y,pizza.r,0,7);ctx.fill();
}

// ===== GAME =====
function shoot(){
  if(player.cooldown>0||!running)return;
  bullets.push({x:player.x,y:player.y-20,vy:-4});
  player.cooldown=8;
}

function update(){
  if(!running)return;

  player.cooldown=Math.max(0,player.cooldown-1);

  pizza.x+=pizza.vx;
  if(pizza.x<40||pizza.x>280)pizza.vx*=-1;

  bullets.forEach(b=>b.y+=b.vy);

  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    if(Math.hypot(b.x-pizza.x,b.y-pizza.y)<pizza.r){
      bullets.splice(i,1);
      score+=10;
      scoreEl.textContent=score;
    }
    if(b.y<0)bullets.splice(i,1);
  }

  // granelli neve
  if(Math.random()<0.4)
    grains.push({x:Math.random()*W,y:-2,vy:0.6+Math.random()});

  grains.forEach(g=>g.y+=g.vy);
  for(let i=grains.length-1;i>=0;i--)
    if(grains[i].y>H)grains.splice(i,1);
}

function render(){
  ctx.fillStyle="#050712";
  ctx.fillRect(0,0,W,H);

  drawPizza();
  drawAromat();

  ctx.fillStyle="#facc15";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,2,4));

  ctx.fillStyle="#fde68a";
  grains.forEach(g=>ctx.fillRect(g.x,g.y,1,1));
}

function loop(){
  update();
  render();
  if(running)requestAnimationFrame(loop);
}

// ===== TIMER =====
function startTimer(){
  timeLeft=15;
  timeEl.textContent=timeLeft;
  clearInterval(timerId);
  timerId=setInterval(()=>{
    if(!running){clearInterval(timerId);return;}
    timeLeft--;
    timeEl.textContent=timeLeft;
    if(timeLeft<=0){
      running=false;
      banner.classList.add("show");
      startBtn.classList.add("blink");
      clearInterval(timerId);
    }
  },1000);
}

// ===== START =====
function startGame(){
  score=0;
  bullets.length=0;
  grains.length=0;
  banner.classList.remove("show");
  scoreEl.textContent=0;
  running=true;
  startBtn.classList.remove("blink");
  startTimer();
  loop();
}

// ===== TOUCH =====
let dragId=null, dragStartX=0, playerStartX=0;

c.addEventListener("pointerdown",e=>{
  c.setPointerCapture(e.pointerId);
  if(dragId===null){
    dragId=e.pointerId;
    dragStartX=e.clientX;
    playerStartX=player.x;
  }else shoot();
});

c.addEventListener("pointermove",e=>{
  if(e.pointerId!==dragId||!running)return;
  const r=c.getBoundingClientRect();
  const dx=(e.clientX-dragStartX)*(W/r.width);
  player.x=Math.max(20,Math.min(300,playerStartX+dx));
});

c.addEventListener("pointerup",e=>{
  if(e.pointerId===dragId){
    shoot();
    dragId=null;
  }
});

// fallback buttons
document.getElementById("left").onpointerdown=()=>player.x=Math.max(20,player.x-10);
document.getElementById("right").onpointerdown=()=>player.x=Math.min(300,player.x+10);
document.getElementById("fire").onpointerdown=shoot;

startBtn.onclick=()=>{if(!running)startGame();};
</script>
</body>
</html>
