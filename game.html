<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Aromat Pizza 1986</title>

<style>
body{
  margin:0;
  background:#070b18;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family: monospace;
  color:#c7d2fe;
  touch-action:none;
}
.wrap{
  background:#0f1629;
  border:3px solid #2a3350;
  padding:14px;
  box-shadow:0 0 0 4px #050712;
  position:relative;
}
canvas{
  width:min(92vw,720px);
  image-rendering:pixelated;
  border:2px solid #2a3350;
  background:#050712;
}
.hud{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}
.hud b{color:#facc15}

.start{
  margin-top:10px;
  width:100%;
  padding:18px;
  font-size:24px;
  font-weight:bold;
  background:#111a33;
  color:#facc15;
  border:3px solid #facc15;
  cursor:pointer;
}
.start.blink{
  animation: blink 1s infinite;
}
@keyframes blink{
  0%,50%{opacity:1}
  51%,100%{opacity:0.3}
}

.controls{
  margin-top:10px;
  display:flex;
  gap:10px;
}
.controls button{
  flex:1;
  padding:12px;
  font-size:16px;
  background:#111a33;
  border:2px solid #2a3350;
  color:#fff;
}
.controls button:active{
  transform:translateY(1px);
}

/* ===== BANNER FINALE ===== */
.banner{
  position:absolute;
  inset:0;
  background:rgba(5,7,18,0.92);
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
  border:3px solid #facc15;
}
.banner.show{
  display:flex;
}
.banner .box{
  background:#0f1629;
  border:3px solid #facc15;
  padding:20px;
  box-shadow:0 0 0 4px #050712;
}
.banner h1{
  margin:0 0 10px;
  font-size:20px;
  color:#facc15;
}
.banner p{
  margin:0;
  font-size:16px;
  color:#e5e7eb;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="hud">
    <div>Score <b id="score">0</b></div>
    <div>Vite <b id="lives">3</b></div>
  </div>

  <canvas id="game" width="320" height="180"></canvas>

  <button id="start" class="start blink">START</button>

  <div class="controls">
    <button id="left">◀</button>
    <button id="fire">SPARA</button>
    <button id="right">▶</button>
  </div>

  <!-- BANNER -->
  <div id="banner" class="banner">
    <div class="box">
      <h1>COMPLIMENTI!</h1>
      <p>HAI VINTO L’OPPORTUNITÀ<br>DI OFFRIRMI DA BERE!</p>
    </div>
  </div>
</div>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");
const W=c.width,H=c.height;

let running=false;
let score=0,lives=3;
const scoreEl=document.getElementById("score");
const livesEl=document.getElementById("lives");
const startBtn=document.getElementById("start");
const banner=document.getElementById("banner");

const player={x:160,y:150,w:26,h:40,cd:0};
const bullets=[];
const salini=[];

// ===== PIXEL TEXT =====
function pixelText(txt,x,y,color){
  const map={
    A:["0110","1001","1111","1001","1001"],
    R:["1110","1001","1110","1010","1001"],
    O:["0110","1001","1001","1001","0110"],
    M:["1001","1111","1111","1001","1001"],
    T:["1111","0010","0010","0010","0010"]
  };
  ctx.fillStyle=color;
  let cx=x;
  for(const ch of txt){
    const g=map[ch];
    if(!g){cx+=6;continue}
    for(let r=0;r<5;r++)
      for(let col=0;col<4;col++)
        if(g[r][col]==="1")
          ctx.fillRect(cx+col,y+r,1,1);
    cx+=6;
  }
}

// ===== SPRITES =====
function drawAromat(){
  const l=player.x-player.w/2,t=player.y-player.h/2;
  ctx.fillStyle="#f6d32d";
  ctx.fillRect(l,t+6,player.w,player.h-6);
  ctx.fillStyle="#d3181c";
  ctx.fillRect(l+2,t,player.w-4,7);
  ctx.fillStyle="#12a14a";
  ctx.fillRect(l+1,t+18,player.w-2,14);
  pixelText("AROMAT",l+4,t+22,"#fff");
}

function drawPizza(){
  ctx.fillStyle="#d97706";
  ctx.beginPath();ctx.arc(160,60,26,0,7);ctx.fill();
  ctx.fillStyle="#fef3c7";
  ctx.beginPath();ctx.arc(160,60,22,0,7);ctx.fill();
}

function drawSalino(s){
  ctx.fillStyle="#e5e7eb";
  ctx.fillRect(s.x-3,s.y-3,6,6);
  ctx.fillStyle="#9ca3af";
  ctx.fillRect(s.x-1,s.y-1,2,2);
}

// ===== GAME =====
function shoot(){
  if(player.cd>0)return;
  bullets.push({x:player.x,y:player.y-20,vy:-4});
  player.cd=10;
}

function spawnSalino(){
  salini.push({x:20+Math.random()*280,y:-10,vy:1.2});
}

function update(){
  if(!running)return;

  player.cd=Math.max(0,player.cd-1);
  if(Math.random()<0.02)spawnSalino();

  bullets.forEach(b=>b.y+=b.vy);
  salini.forEach(s=>s.y+=s.vy);

  for(let i=salini.length-1;i>=0;i--){
    const s=salini[i];
    if(Math.hypot(s.x-160,s.y-60)<24){
      salini.splice(i,1);
      lives--;
      livesEl.textContent=lives;
      if(lives<=0)gameOver();
    }
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      if(Math.abs(b.x-s.x)<4 && Math.abs(b.y-s.y)<4){
        bullets.splice(j,1);
        salini.splice(i,1);
        score+=10;
        scoreEl.textContent=score;
        break;
      }
    }
  }
}

function render(){
  ctx.fillStyle="#050712";
  ctx.fillRect(0,0,W,H);
  drawPizza();
  drawAromat();
  bullets.forEach(b=>{
    ctx.fillStyle="#facc15";
    ctx.fillRect(b.x,b.y,2,4);
  });
  salini.forEach(drawSalino);
}

function loop(){
  update();
  render();
  if(running)requestAnimationFrame(loop);
}

function startGame(){
  score=0;lives=3;
  bullets.length=0;salini.length=0;
  scoreEl.textContent=0;
  livesEl.textContent=3;
  banner.classList.remove("show");
  running=true;
  startBtn.classList.remove("blink");
  loop();
}

function gameOver(){
  running=false;
  startBtn.classList.add("blink");
  banner.classList.add("show");
}

// ===== INPUT =====
document.getElementById("left").onpointerdown=()=>player.x=Math.max(20,player.x-10);
document.getElementById("right").onpointerdown=()=>player.x=Math.min(300,player.x+10);
document.getElementById("fire").onpointerdown=shoot;

startBtn.onclick=()=>{
  if(!running)startGame();
};
</script>
</body>
</html>
