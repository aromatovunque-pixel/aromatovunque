<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Aromat Pizza Touch</title>

<style>
body{
  margin:0;
  background:#070b18;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family: monospace;
  color:#c7d2fe;
  touch-action:none;
}
.wrap{
  background:#0f1629;
  border:3px solid #2a3350;
  padding:12px;
  box-shadow:0 0 0 4px #050712;
  position:relative;
}
canvas{
  width:min(96vw,420px);
  image-rendering:pixelated;
  border:2px solid #2a3350;
  background:#050712;
  touch-action:none;
}
.hud{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-size:14px;
}
.hud b{color:#facc15}

.start{
  margin-top:8px;
  width:100%;
  padding:14px;
  font-size:22px;
  font-weight:bold;
  background:#111a33;
  color:#facc15;
  border:3px solid #facc15;
}
.start.blink{
  animation: blink 1s infinite;
}
@keyframes blink{
  0%,50%{opacity:1}
  51%,100%{opacity:0.3}
}

.controls{
  margin-top:8px;
  display:flex;
  gap:8px;
}
.controls button{
  flex:1;
  padding:10px;
  font-size:16px;
  background:#111a33;
  border:2px solid #2a3350;
  color:#fff;
}
.controls button:active{
  transform:translateY(1px);
}
</style>
</head>

<body>
<div class="wrap">
  <div class="hud">
    <div>Score <b id="score">0</b></div>
    <div>Tempo <b id="time">30</b>s</div>
  </div>

  <canvas id="game" width="320" height="180"></canvas>

  <button id="start" class="start blink">START</button>

  <div class="controls">
    <button id="left">◀</button>
    <button id="fire">SPARA</button>
    <button id="right">▶</button>
  </div>
</div>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");
const W=c.width,H=c.height;

let running=false;
let score=0;
let timeLeft=30;

const scoreEl=document.getElementById("score");
const timeEl=document.getElementById("time");
const startBtn=document.getElementById("start");

const player={x:160,y:150,w:26,h:36,cd:0};
const bullets=[];

const pizza={
  x:160,y:60,r:20,
  vx:1.4
};

// ===== PIXEL TEXT =====
function pixelText(txt,x,y,color){
  const map={
    A:["0110","1001","1111","1001","1001"],
    R:["1110","1001","1110","1010","1001"],
    O:["0110","1001","1001","1001","0110"],
    M:["1001","1111","1111","1001","1001"],
    T:["1111","0010","0010","0010","0010"]
  };
  ctx.fillStyle=color;
  let cx=x;
  for(const ch of txt){
    const g=map[ch];
    if(!g){cx+=6;continue}
    for(let r=0;r<5;r++)
      for(let col=0;col<4;col++)
        if(g[r][col]==="1")
          ctx.fillRect(cx+col,y+r,1,1);
    cx+=6;
  }
}

// ===== SPRITES =====
function drawAromat(){
  const l=player.x-player.w/2,t=player.y-player.h/2;
  ctx.fillStyle="#f6d32d";
  ctx.fillRect(l,t+6,player.w,player.h-6);
  ctx.fillStyle="#d3181c";
  ctx.fillRect(l+2,t,player.w-4,7);
  ctx.fillStyle="#12a14a";
  ctx.fillRect(l+1,t+18,player.w-2,14);
  pixelText("AROMAT",l+4,t+22,"#fff");
}

function drawPizza(){
  ctx.fillStyle="#d97706";
  ctx.beginPath();ctx.arc(pizza.x,pizza.y,pizza.r+4,0,7);ctx.fill();
  ctx.fillStyle="#fef3c7";
  ctx.beginPath();ctx.arc(pizza.x,pizza.y,pizza.r,0,7);ctx.fill();
}

// ===== GAME =====
function shoot(){
  if(player.cd>0 || !running) return;
  bullets.push({x:player.x,y:player.y-20,vy:-4});
  player.cd=8;
}

function update(){
  if(!running) return;

  player.cd=Math.max(0,player.cd-1);

  // pizza movement
  pizza.x+=pizza.vx;
  if(pizza.x<40 || pizza.x>280) pizza.vx*=-1;

  bullets.forEach(b=>b.y+=b.vy);

  // collisions
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    if(Math.hypot(b.x-pizza.x,b.y-pizza.y)<pizza.r){
      bullets.splice(i,1);
      score+=10;
      scoreEl.textContent=score;
    }
    if(b.y<0) bullets.splice(i,1);
  }
}

function render(){
  ctx.fillStyle="#050712";
  ctx.fillRect(0,0,W,H);

  drawPizza();
  drawAromat();

  ctx.fillStyle="#facc15";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,2,4));
}

function loop(){
  update();
  render();
  if(running) requestAnimationFrame(loop);
}

function startGame(){
  score=0;
  timeLeft=30;
  bullets.length=0;
  scoreEl.textContent=0;
  timeEl.textContent=30;
  running=true;
  startBtn.classList.remove("blink");
  loop();

  const timer=setInterval(()=>{
    if(!running){clearInterval(timer);return;}
    timeLeft--;
    timeEl.textContent=timeLeft;
    if(timeLeft<=0){
      running=false;
      startBtn.classList.add("blink");
      clearInterval(timer);
    }
  },1000);
}

// ===== TOUCH CONTROL =====
let dragStartX=0, playerStartX=0;
c.addEventListener("pointerdown",e=>{
  dragStartX=e.clientX;
  playerStartX=player.x;
  shoot();
});
c.addEventListener("pointermove",e=>{
  if(!running) return;
  const rect=c.getBoundingClientRect();
  const scale=W/rect.width;
  const dx=(e.clientX-dragStartX)*scale;
  player.x=Math.max(20,Math.min(300,playerStartX+dx));
});

// buttons fallback
document.getElementById("left").onpointerdown=()=>player.x=Math.max(20,player.x-10);
document.getElementById("right").onpointerdown=()=>player.x=Math.min(300,player.x+10);
document.getElementById("fire").onpointerdown=shoot;

startBtn.onclick=()=>{
  if(!running) startGame();
};
</script>
</body>
</html>
